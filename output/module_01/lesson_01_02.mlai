<?xml version="1.0" encoding="UTF-8"?>
<Lesson>
  <Meta>
    <Id>lesson-01-02</Id>
    <Title>Integrate-and-Fire Models: Minimal Neuronal Dynamics</Title>
    <Version>1</Version>
    <Tags>
      <Tag>computational-neuroscience</Tag>
      <Tag>integrate-and-fire</Tag>
      <Tag>neuronal-dynamics</Tag>
      <Tag>dynamical-systems</Tag>
      <Tag>spiking-models</Tag>
    </Tags>
  </Meta>

  <H1>Integrate-and-Fire Models: Minimal Neuronal Dynamics</H1>

  <Body>The integrate-and-fire (IF) model represents one of the most elegant simplifications in computational neuroscience. By stripping away the intricate biophysical details of action potential generation, this model captures the essential computation performed by neurons: integrating synaptic inputs until a threshold is reached, then firing and resetting. This lesson builds on the dynamical systems foundations from the previous lesson, connecting continuous-time dynamics with discrete threshold-crossing events.</Body>

  <H2>From RC Circuits to Neuronal Membranes</H2>

  <Body>The neuronal membrane behaves like an electrical RC circuit. The lipid bilayer acts as a capacitor (C), while ion channels provide a resistive leak conductance (g_L). When current I is injected into such a circuit, Kirchhoff's current law gives us the fundamental equation governing passive membrane dynamics.</Body>

  <H3>The Leaky Integrate-and-Fire Equation</H3>

  <Body>The membrane potential V evolves according to:</Body>

  <Code lang="plaintext">
C dV/dt = -g_L(V - V_rest) + I
  </Code>

  <Body>Here, C is the membrane capacitance, g_L is the leak conductance, V_rest is the resting potential (typically around -70 mV), and I is the injected current. The term -g_L(V - V_rest) represents the passive leak current that drives V back toward rest.</Body>

  <Body>Dividing through by g_L and defining the membrane time constant tau = C/g_L, we obtain the standard form:</Body>

  <Code lang="plaintext">
tau dV/dt = -(V - V_rest) + I/g_L
  </Code>

  <Body>The membrane time constant tau (typically 10-30 ms for cortical neurons) determines how quickly the membrane potential responds to input changes. This is the same parameter that governs the exponential decay toward fixed points that we encountered in the previous lesson on dynamical systems.</Body>

  <FlashCard id="fc1">
    <Front>What is the membrane time constant and how is it calculated?</Front>
    <Back>The membrane time constant tau = C/g_L represents the characteristic timescale of membrane dynamics. It determines how quickly the membrane potential decays toward its resting value and how rapidly it integrates synaptic inputs.</Back>
  </FlashCard>

  <FlashCard id="fc2">
    <Front>What physical components does the neuronal membrane correspond to in an RC circuit?</Front>
    <Back>The lipid bilayer acts as a capacitor (C) that stores charge, while ion channels provide a resistive leak conductance (g_L) that allows current to flow across the membrane.</Back>
  </FlashCard>

  <H2>Threshold, Spike, and Reset</H2>

  <Body>The integrate-and-fire model captures action potential generation through a simple rule: when the membrane potential V reaches or exceeds a threshold V_thre, the neuron emits a spike, and V is instantaneously reset to a reset potential V_reset (often equal to V_rest).</Body>

  <Code lang="plaintext">
If V &gt;= V_thre:
    Record spike time
    V := V_reset
  </Code>

  <Body>This threshold-reset mechanism transforms the continuous dynamics of membrane integration into discrete spiking events. The combination of continuous subthreshold dynamics and discrete spike generation makes the IF model a hybrid dynamical system.</Body>

  <Body>Crucially, the IF model does not reproduce the actual shape of an action potential. It captures only the timing of spikes, not the stereotyped voltage trajectory during a spike. For many questions in neural coding, spike timing is the primary information carrier, making this simplification acceptable.</Body>

  <FlashCard id="fc3">
    <Front>What happens when the membrane potential reaches threshold in the IF model?</Front>
    <Back>A spike is recorded at the current time, and the membrane potential is instantaneously reset to V_reset. This discrete event creates the hybrid nature of the IF model: continuous integration followed by discontinuous reset.</Back>
  </FlashCard>

  <FlashCard id="fc4">
    <Front>What is the key limitation of the integrate-and-fire model regarding action potentials?</Front>
    <Back>The IF model does not reproduce the shape of action potentials. It captures only spike timing through the threshold-reset mechanism, not the stereotyped depolarization and repolarization waveform of real action potentials.</Back>
  </FlashCard>

  <H2>Analytical Solution for Constant Input</H2>

  <Body>For a constant input current I, we can solve the IF equation analytically. The subthreshold dynamics follow a linear first-order ODE. Starting from V(0) = V_reset, the solution is:</Body>

  <Code lang="plaintext">
V(t) = V_rest + (I/g_L)(1 - exp(-t/tau)) + (V_reset - V_rest)exp(-t/tau)
  </Code>

  <Body>For the special case where V_reset = V_rest, this simplifies to:</Body>

  <Code lang="plaintext">
V(t) = V_rest + (I/g_L)(1 - exp(-t/tau))
  </Code>

  <Body>As t approaches infinity, V approaches V_rest + I/g_L. For the neuron to fire, this asymptotic value must exceed V_thre, which requires:</Body>

  <Code lang="plaintext">
I &gt; g_L(V_thre - V_rest) = I_rheobase
  </Code>

  <Body>The quantity I_rheobase represents the minimum sustained current required to elicit spiking. Below rheobase, the membrane potential approaches a stable subthreshold equilibrium.</Body>

  <H3>Computing the Interspike Interval</H3>

  <Body>When I exceeds rheobase, we can compute the time T to reach threshold from reset. Setting V(T) = V_thre and solving:</Body>

  <Code lang="plaintext">
T = tau * ln((I/g_L - V_reset + V_rest) / (I/g_L - V_thre + V_rest))
  </Code>

  <Body>For V_reset = V_rest, this becomes:</Body>

  <Code lang="plaintext">
T = tau * ln(I/g_L / (I/g_L - (V_thre - V_rest)))
  </Code>

  <Body>The firing rate f is simply the reciprocal of the interspike interval: f = 1/T. This analytical expression allows us to derive the frequency-current (f-I) relationship for the IF neuron.</Body>

  <FlashCard id="fc5">
    <Front>What is rheobase in the context of the IF model?</Front>
    <Back>Rheobase is the minimum sustained current required to elicit spiking: I_rheobase = g_L(V_thre - V_rest). Below rheobase, the membrane potential approaches a stable subthreshold equilibrium and the neuron never fires.</Back>
  </FlashCard>

  <FlashCard id="fc6">
    <Front>How is firing rate related to the interspike interval?</Front>
    <Back>Firing rate f is the reciprocal of the interspike interval T: f = 1/T. For constant input, T is the time required for the membrane potential to reach threshold from reset.</Back>
  </FlashCard>

  <H2>The Frequency-Current (f-I) Curve</H2>

  <Body>The f-I curve characterizes how a neuron transforms input current into firing rate. For the IF model with constant input, we can derive this relationship analytically. Just above rheobase, firing rates are low because the membrane potential approaches threshold slowly. As current increases, firing rates rise, but the relationship is not linear.</Body>

  <Body>The f-I curve for the standard IF model shows characteristic features: zero firing below rheobase, a steep onset just above rheobase, and an approximately linear regime at higher currents. However, unlike biological neurons, the IF model predicts arbitrarily high firing rates for sufficiently large inputs, a limitation addressed by adding refractory periods.</Body>

  <H2>Numerical Implementation</H2>

  <Body>For time-varying inputs, analytical solutions are generally unavailable, and we must resort to numerical integration. The forward Euler method provides a straightforward approach:</Body>

  <Code lang="python">
import numpy as np

def simulate_if_neuron(I, dt, T_total, tau, V_rest, V_thre, V_reset, g_L):
    """
    Simulate an integrate-and-fire neuron.

    Parameters:
    -----------
    I : array or float
        Input current (can be time-varying array or constant)
    dt : float
        Time step (ms)
    T_total : float
        Total simulation time (ms)
    tau : float
        Membrane time constant (ms)
    V_rest : float
        Resting potential (mV)
    V_thre : float
        Threshold potential (mV)
    V_reset : float
        Reset potential (mV)
    g_L : float
        Leak conductance (nS)

    Returns:
    --------
    t : array
        Time points
    V : array
        Membrane potential trace
    spike_times : list
        Times of spikes
    """
    n_steps = int(T_total / dt)
    t = np.arange(n_steps) * dt
    V = np.zeros(n_steps)
    V[0] = V_reset
    spike_times = []

    # Handle constant vs time-varying input
    if np.isscalar(I):
        I = np.ones(n_steps) * I

    for i in range(1, n_steps):
        # Euler integration of subthreshold dynamics
        dV = (-(V[i-1] - V_rest) + I[i-1]/g_L) * dt / tau
        V[i] = V[i-1] + dV

        # Threshold crossing and reset
        if V[i] &gt;= V_thre:
            spike_times.append(t[i])
            V[i] = V_reset

    return t, V, spike_times
</Code>

  <Body>Note the critical importance of checking for threshold crossing AFTER updating V, and then applying the reset. A common implementation error is forgetting the reset step, leading to voltage traces that remain stuck at or above threshold.</Body>

  <H3>Computing the f-I Curve Numerically</H3>

  <Code lang="python">
def compute_fi_curve(I_values, dt, T_total, tau, V_rest, V_thre, V_reset, g_L,
                     discard_transient=100):
    """
    Compute the frequency-current curve.

    Parameters:
    -----------
    I_values : array
        Range of input currents to test
    discard_transient : float
        Time to discard at start (ms) to avoid transient effects

    Returns:
    --------
    firing_rates : array
        Firing rate for each input current
    """
    firing_rates = []

    for I in I_values:
        t, V, spike_times = simulate_if_neuron(
            I, dt, T_total, tau, V_rest, V_thre, V_reset, g_L
        )

        # Count spikes after transient
        spikes_after_transient = [s for s in spike_times if s &gt; discard_transient]

        # Compute firing rate
        if len(spikes_after_transient) &gt; 1:
            rate = len(spikes_after_transient) / (T_total - discard_transient) * 1000
        else:
            rate = 0.0

        firing_rates.append(rate)

    return np.array(firing_rates)
</Code>

  <H2>Response to Step Current</H2>

  <Body>When a step current is applied to an IF neuron at rest, there is a delay (latency) before the first spike. This latency depends on the current amplitude and can be computed analytically. For a step from I=0 to I (suprathreshold), the latency to first spike is given by the same formula as the interspike interval.</Body>

  <Body>However, for currents just above rheobase, this latency can be very long, approaching infinity as I approaches I_rheobase from above. This behavior has implications for neural coding: weakly suprathreshold inputs are detected slowly.</Body>

  <H2>Limitations of the Basic IF Model</H2>

  <Body>While the IF model captures essential aspects of neuronal integration and spiking, several biological features are absent:</Body>

  <Body>1. No action potential shape: The IF model produces point events, not the stereotyped waveform of real spikes.</Body>

  <Body>2. No refractory period: Real neurons have an absolute refractory period during which they cannot fire, followed by a relative refractory period of reduced excitability. The basic IF model fires at arbitrarily high rates for large inputs.</Body>

  <Body>3. No spike-frequency adaptation: Many neurons show decreasing firing rates during sustained stimulation, a phenomenon absent in the basic IF model.</Body>

  <Body>4. Simplified threshold: Real thresholds can be dynamic and history-dependent.</Body>

  <Body>These limitations motivate extensions such as the leaky integrate-and-fire with refractory period (LIF-R), the exponential integrate-and-fire (EIF), and the adaptive exponential integrate-and-fire (AdEx) models, which we will encounter in subsequent lessons.</Body>

  <H2>Connection to Dynamical Systems</H2>

  <Body>The IF model provides an excellent example of connecting continuous dynamics with discrete events. In the subthreshold regime, the system has a single fixed point at V = V_rest + I/g_L. When this fixed point lies below threshold (I less than rheobase), it is a stable attractor. When I exceeds rheobase, the fixed point would lie above threshold, but the reset mechanism prevents the system from reaching it, creating periodic spiking.</Body>

  <Body>This interplay between continuous flow and discrete resets is a hallmark of many biological systems and provides a bridge between the smooth dynamics of the previous lesson and the discrete spike trains that form the currency of neural communication.</Body>

  <H1>Knowledge Check</H1>

  <SingleSelect id="q1">
    <Prompt>A neuron has membrane time constant tau = 20 ms, resting potential V_rest = -70 mV, threshold V_thre = -55 mV, and leak conductance g_L = 10 nS. What is the rheobase current?</Prompt>
    <Options>
      <Option correct="true">150 pA</Option>
      <Option>15 pA</Option>
      <Option>1.5 nA</Option>
      <Option>200 pA</Option>
    </Options>
  </SingleSelect>

  <SingleSelect id="q2">
    <Prompt>In a properly implemented IF simulation, when should the membrane potential be reset to V_reset?</Prompt>
    <Options>
      <Option>Before checking the threshold condition</Option>
      <Option correct="true">After detecting that V has crossed or reached V_thre</Option>
      <Option>At the beginning of each time step</Option>
      <Option>Only when V exceeds V_thre by more than 10 mV</Option>
    </Options>
  </SingleSelect>

  <SingleSelect id="q3">
    <Prompt>For the basic IF model with constant suprathreshold input and no refractory period, what happens to firing rate as input current approaches infinity?</Prompt>
    <Options>
      <Option>It saturates at a maximum value determined by the membrane time constant</Option>
      <Option>It oscillates between high and low values</Option>
      <Option correct="true">It increases without bound</Option>
      <Option>It decreases due to sodium channel inactivation</Option>
    </Options>
  </SingleSelect>

  <MultiSelect id="q4">
    <Prompt>Which of the following are limitations of the basic integrate-and-fire model? (Select all that apply)</Prompt>
    <Options>
      <Option correct="true">No action potential waveform is produced</Option>
      <Option correct="true">No refractory period is included</Option>
      <Option>Cannot produce regular spiking under constant input</Option>
      <Option correct="true">No spike-frequency adaptation</Option>
      <Option>Cannot integrate synaptic inputs</Option>
    </Options>
  </MultiSelect>

  <MultiSelect id="q5">
    <Prompt>Which parameters directly determine the membrane time constant tau in the IF model?</Prompt>
    <Options>
      <Option correct="true">Membrane capacitance C</Option>
      <Option correct="true">Leak conductance g_L</Option>
      <Option>Threshold potential V_thre</Option>
      <Option>Reset potential V_reset</Option>
      <Option>Input current I</Option>
    </Options>
  </MultiSelect>

  <SortQuiz id="q6">
    <Prompt>Order the following events in the IF model simulation from first to last during a single time step where a spike occurs:</Prompt>
    <SortedItems>
      <Item>Read current input value</Item>
      <Item>Compute dV using the membrane equation</Item>
      <Item>Update V = V + dV</Item>
      <Item>Check if V &gt;= V_thre</Item>
      <Item>Record spike time</Item>
      <Item>Reset V to V_reset</Item>
    </SortedItems>
  </SortQuiz>

  <SortQuiz id="q7">
    <Prompt>Order the following input currents from lowest to highest expected firing rate in an IF neuron (rheobase = 100 pA):</Prompt>
    <SortedItems>
      <Item>50 pA (subthreshold)</Item>
      <Item>101 pA (just above rheobase)</Item>
      <Item>150 pA</Item>
      <Item>300 pA</Item>
    </SortedItems>
  </SortQuiz>

  <MatchPairs id="q8">
    <Prompt>Match each IF model parameter to its physical interpretation:</Prompt>
    <Pairs>
      <Pair><Left>tau = C/g_L</Left><Right>Timescale of membrane response</Right></Pair>
      <Pair><Left>V_thre</Left><Right>Voltage that triggers spike generation</Right></Pair>
      <Pair><Left>V_reset</Left><Right>Post-spike membrane potential</Right></Pair>
      <Pair><Left>I_rheobase</Left><Right>Minimum current for sustained firing</Right></Pair>
    </Pairs>
    <RightDistractors>
      <Distractor>Maximum firing frequency</Distractor>
      <Distractor>Action potential amplitude</Distractor>
    </RightDistractors>
  </MatchPairs>

  <MatchPairs id="q9">
    <Prompt>Match each scenario to the expected behavior in the IF model:</Prompt>
    <Pairs>
      <Pair><Left>I &lt; I_rheobase</Left><Right>V reaches stable subthreshold equilibrium</Right></Pair>
      <Pair><Left>I = I_rheobase</Left><Right>V asymptotically approaches V_thre</Right></Pair>
      <Pair><Left>I &gt; I_rheobase</Left><Right>Periodic spiking occurs</Right></Pair>
      <Pair><Left>I &gt;&gt; I_rheobase</Left><Right>Very high frequency firing</Right></Pair>
    </Pairs>
    <RightDistractors>
      <Distractor>Spike-frequency adaptation</Distractor>
      <Distractor>Chaotic membrane dynamics</Distractor>
    </RightDistractors>
  </MatchPairs>

  <FillBlanks id="q10">
    <Prompt>
      The membrane time constant tau equals <Blank>C/g_L</Blank> and has units of <Blank>milliseconds</Blank>. Below rheobase, the membrane potential approaches a stable <Blank>equilibrium</Blank> without spiking.
    </Prompt>
    <Distractors>
      <Distractor>g_L/C</Distractor>
      <Distractor>hertz</Distractor>
      <Distractor>oscillation</Distractor>
      <Distractor>threshold</Distractor>
    </Distractors>
  </FillBlanks>

  <FillBlanks id="q11">
    <Prompt>
      The firing rate f equals <Blank>1/T</Blank> where T is the <Blank>interspike interval</Blank>. The rheobase current equals <Blank>g_L(V_thre - V_rest)</Blank>.
    </Prompt>
    <Distractors>
      <Distractor>T/tau</Distractor>
      <Distractor>refractory period</Distractor>
      <Distractor>C(V_thre - V_rest)</Distractor>
      <Distractor>membrane time constant</Distractor>
    </Distractors>
  </FillBlanks>

  <Subjective id="q12">
    <Prompt>Explain why the integrate-and-fire model produces unrealistically high firing rates for very large input currents, and describe one modification that could address this limitation. Your answer should demonstrate understanding of both the mathematical basis of the problem and its biological relevance.</Prompt>
    <Rubric>
      <Criterion points="3" required="true">
        <Requirement>Explains that the basic IF model has no mechanism to limit firing rate because the interspike interval can become arbitrarily small as current increases</Requirement>
        <Indicators>no limit, arbitrarily small interval, infinite rate, no saturation, ISI decreases, time to threshold</Indicators>
      </Criterion>
      <Criterion points="3" required="true">
        <Requirement>Describes adding a refractory period as a solution, where the neuron cannot fire (absolute) or has reduced excitability (relative) for a fixed time after each spike</Requirement>
        <Indicators>refractory period, absolute refractory, relative refractory, cannot fire, minimum ISI, recovery time</Indicators>
      </Criterion>
      <Criterion points="2">
        <Requirement>Connects to biology by noting that real neurons have refractory periods due to sodium channel inactivation and potassium channel dynamics</Requirement>
        <Indicators>sodium channel, inactivation, potassium, ion channel, biological, realistic, physiological</Indicators>
      </Criterion>
      <Criterion points="2">
        <Requirement>Mentions that the refractory period imposes a maximum firing rate (e.g., around 500-1000 Hz for many neurons)</Requirement>
        <Indicators>maximum rate, upper limit, saturation, 500 Hz, 1000 Hz, kHz, bounded</Indicators>
      </Criterion>
    </Rubric>
    <Constraints minWords="50" maxWords="300" />
  </Subjective>

  <Subjective id="q13">
    <Prompt>A colleague has implemented an IF model but observes that after the first spike, the membrane potential remains stuck at the threshold value. Diagnose the likely implementation error and explain how to fix it. Provide pseudocode or a code snippet illustrating the correct implementation.</Prompt>
    <Rubric>
      <Criterion points="4" required="true">
        <Requirement>Correctly identifies that the reset mechanism is missing or incorrectly placed - V is not being reset to V_reset after threshold detection</Requirement>
        <Indicators>reset missing, forgot reset, no reset, V_reset not applied, reset mechanism, not resetting</Indicators>
      </Criterion>
      <Criterion points="3" required="true">
        <Requirement>Provides correct pseudocode or code showing threshold check followed by spike recording and reset</Requirement>
        <Indicators>if V &gt;= V_thre, V = V_reset, code, pseudocode, implementation</Indicators>
      </Criterion>
      <Criterion points="2">
        <Requirement>Explains that without reset, V cannot decrease below threshold under suprathreshold input, causing it to remain at threshold</Requirement>
        <Indicators>cannot decrease, stays at threshold, stuck, no way to return, subthreshold dynamics</Indicators>
      </Criterion>
      <Criterion points="1">
        <Requirement>Notes that the check should occur after voltage update in each time step</Requirement>
        <Indicators>after update, order, sequence, timing, each step</Indicators>
      </Criterion>
    </Rubric>
    <Constraints minWords="75" maxWords="350" />
  </Subjective>

</Lesson>
